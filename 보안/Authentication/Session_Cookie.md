# **1. 인증이 필요한 이유**

- Connectionless 프로토콜(비연결지향)<br>
  -> 클라이언트가 서버에 요청(Request)을 했을 때,그 요청에 맞는 응답(Response)을 보낸 후 연결을 끊는 처리방식
- 웹서버는 HTTP 프로토콜(Stateless)을 사용하기 때문에 사용자의 로그인 여부에 대한 상태가 존재하지 않음
- 하지만 사용자가 매번 웹페이지의 서비스를 사용할때 매번 로그인 요청을 할순 없음
- 따라서 사용자가 로그인 한 회원인지 아닌지 관리하지 위해 인증을 사용함

---

# **2. Session, Cookie**

## **1. Session**

- 일정 시간동안 같은 브라우저로 부터 들어오는 일련의 요청을 하나의 상태로 보고, 그 상태를 유지하는것
- 방문자가 웹서버에 접속한 상태를 하나의 단위로 보고 세션이라고 한다.

## **2. Cookie**

- 서버에서 클라이언트에 데이터를 저장하는 방법의 하나
- 상태 정보를 유지하는 기술

## **3. Session VS Cookie**

|         |                                           설명                                            | 상태저장 경로 |          장점          |                               단점                                |
| :-----: | :---------------------------------------------------------------------------------------: | :-----------: | :--------------------: | :---------------------------------------------------------------: |
| Cookie  |                                 stateless를 보완하기 위함                                 |  클라이언트   |  서버에 부담을 덜어줌  |                    쿠키자체는 인증방법이 아님                     |
| Session | 상태를 서버가 가지고있음(stateful)<br>접속상태와 권한부여를 위해 세션아이디를 쿠키로 전송 |     서버      | 서버에서 유저확인 가능 | 서버에서 모든 상태를 가지고 있음<br>사용자가 많으면 관리가 어려움 |

## **4. 동작 방식**

1. 사용자가 로그인 요청, 요청이 유효(id, psw 일치)하면 세션이 서버의 메모리,session store에 저장됨<br>-> 세션 식별키로 sessionId를 기준으로 정보저장
2. 서버에서 클라이언트로 쿠키에 sessionId를 cookie에 담아 클라이언트에 전달
3. 브라우저는 서비스 사용시 모든 요청에 cookie(sessionId)를 전송
4. 서버는 클라이언트가 보낸 sessionId를 키로 서버 메모리,session store에서 사용자의 session정보 식별<br>-> 유효하다면, 요청에 대한 응답

<img src="https://oopy.lazyrockets.com/api/v2/notion/image?src=https%3A%2F%2Fs3-us-west-2.amazonaws.com%2Fsecure.notion-static.com%2Fe753000d-4d5c-488a-98d9-f93cf2888eef%2FUntitled.png&blockId=6964a132-e48e-4b06-86eb-855b78d85005" width="450" height="380">

## **5. Session 특징**

- 서버에서 클라이언트의 상태를 메모리, DB등을 통해 가지고 있음
- 클라이언트의 상태를 서버에서 계속 유지하고 이 정보를 서비스에 이용하는 Stateful 서버

## **6. Cookie 특징**

- 서버가 클라이언트에 데이터를 저장할 수 있다.
- 보안등의 이유로 여러 옵션들이 사용되고 있고 설정에 따라 조건이 맞을 경우에만 쿠키를 가져올수 있음.
- 서버는 클라이언트에 인증정보를 담은 쿠키를 전송하고, 클라이언트는 전달받은 쿠키를 요청과 같이 전송하여<br>Stateless 한 인터넷 연결을 Stateful 하게 유지할 수 있음

## **7. Session 장점**

- 서버에서 상태를 유지하고 있기 때문에 사용자 로그인 여부 확인가능
- 클라이언트가 임의로 정보를 변경해도 서버에서 정보를 관리하므로 상대적으로 안전

## **7. Session 단점**

- 서버에서 클라이언트의 상태를 모두 유지하고 있어야 하므로, 클라이언트 수에 따른 메모리나 디스크 또는 DB에 부하가 심하다.
- 사용자가 많아지는 경우 로드 밸런싱을 사용한 서버 확장을 이용해야 하는데 이 때 세션의 관리가 어려워진다.

---

### ⚙️ Cookie Option

- Domain : 클라이언트 쿠키의 도메인 옵션과 서버의 도메인이 일치해야만 쿠키 전송가능
- Path : 세부경로는 서버라 라우팅할떄 사용하는경로(Default : "/")<br>설정된 Path를 전부 만족하는 경우에만 쿠키 전송가능
- MaxAge, Expires : 쿠키의 유효기간 설정
- Secure : 프로토콜에 따른 쿠키 전송 여부 설정(Default: "false")<br>"true"로 설정 할 경우 HTTPS 프로토콜에서만 전송가능
- Samesite: Cross-Origin 요청을 받은 경우 메소드와 옵션의 조합으로 쿠키 전송여부 결정<br>
  Lax: Cross-Origin 요청이면 'GET' 메소드에 대해서만 쿠키 전송<br>
  Strict : Cross-Origin이 아닌 same-site(origin, server 도메인일치)인 경우에만 쿠키 전송<br>
  None: 항상 쿠키를 전송가능. 쿠키 옵션 중 Secure 옵션 필요
